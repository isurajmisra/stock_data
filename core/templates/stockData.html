<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Stock Data</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script type="text/javascript">
      google.charts.load('current', {
      callback: function () {
        var chart = new google.visualization.AreaChart($('#chart').get(0));

        function drawChart() {
          $.ajax({
            url: '{% url 'get_intraday_data' %}',
                    dataType: 'json',
                  }).done(function (results) {
                  console.log(results);
                    var data = new google.visualization.DataTable();
                    data.addColumn('number', 'Time');
                    data.addColumn('number', 'Difference');


                    $.each(results, function (i, row) {
                      data.addRow([
                        parseInt(row.time),
                        row.diff,

                      ]);
                    });

                    chart.draw(data, {
                      animation: {
                        startup: true,
                        duration: 1000
                      },
                      title: 'Intraday Data',
                      curveType: 'function',
                      displayAnnotations: true
                    });
                  });
                }
                drawChart();
                setInterval(drawChart, 303000);
              },
              packages: ['corechart']
            });
    </script>
</head>
<body>
        <div class="ques">

            <form method="POST" action="/get_data/">
                {%csrf_token%}
                <h3>
                Select Your Index Symbol

                </h3>
                <select id="symbol" class="selectGrades form-control form-control-lg" name="symbol">
                    <option value="BANKNIFTY" selected>BANKNIFTY</option>
                    <option value="NIFTY">NIFTY</option>
                </select>


                <button type="submit" class="btn">Submit</button>
            </form>

        </div >

        {%if symbol%}
            <h1>Selected Symbol : {{symbol}}</h1>
            <h3>Total difference in Change In Open Interest:{{diff_changeinOpenInterest}}</h3>
            <h3>Call According to data : {{call}}</h3>
            <h5>CE Change in Open Interest Sum : {{ce_sum}}</h5>
            <h5>PE Change in Open Interest Sum : {{pe_sum}}</h5>

            <h1>CE Data</h1>
            {% autoescape off %}
            {{ce_data}}
            {% endautoescape %}
            <h1>PE Data</h1>
            {% autoescape off %}
            {{pe_data}}
            {% endautoescape %}
        {%endif%}
<div id="chart" style="width: 900px; height: 500px"></div>
</body>
</html>